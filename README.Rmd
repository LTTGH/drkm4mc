---
title: "Kernel machines for missing covariates"
author: "Tiantian Liu"
date: "2020/06/26"
output: html_document
---

### R/drkm4mc: Kernel machines for missing covariates

[R/drkm4mc](https://github.com/LTTGH/drkm4mc) is an [R](https:/www.r-project.org) package. 
This package is used to construct kernel machines with missing covariates for the problem of classification. A doubly robust kernel machine and a weighted-complete-case kernel machies are given.

#### Installation
You can install it from its [GitHub repository](https://github.com/LTTGH/drkm4mc)

#### Example use
The example is the veterbral dataset, the dataset was split into two sets, 
the first dataset is used to train the doubly-robust kernel machine with samplesize 200.
The remaining dataset is used to test the  doubly-robust kernel machine with samplesize 110. 


```{r}
library(drkm4mc)
vData=VertebralData
trainSampleSize=200
trainLable=sample(c(1:310),trainSampleSize,replace = F)
trainData=vData[trainLable,] 
testLabel=setdiff(c(1:310),trainLable)
testData=vData[testLabel,]
```

First generate the missing mechanism in the training dataset. Assume that 
x4 and x5 are the covariates that are popentially missing.
```{r}
x1=trainData$x1
x2=trainData$x2
x3=trainData$x3
x4=trainData$x4
x5=trainData$x5
x6=trainData$x6
alpha=2
beta=-11
stdx1=(x1-mean(x1))/sd(x1)
stdx2=(x2-mean(x2))/sd(x2)
PScov=(stdx1+stdx2)/2
probR=exp(alpha+beta*(PScov*trainData$Y))/(1+exp(alpha+beta*(PScov*trainData$Y)))
R=rbinom(trainSampleSize,1,probR)
```

Vertebral data with missing covariates is
```{r}
misCovDat=as.data.frame(cbind(x1,x2,x3,x6,x4,x5,R,trainData$Y,trainData$Y1))
names(misCovDat)=c("x1","x2","x3","x4","x5","x6","R","Y","Y1")
```


Set the pathes of imputation model and propensity score model 
```{r}
psPath=url(("https://github.com/LTTGH/drkm4mc/raw/master/ModelPS1.RDS"))
impPath=url(("https://github.com/LTTGH/drkm4mc/raw/master/ModelImp1.RDS"))
```

Train the doubly-robust kernel machines
```{r}
trainRes=trainingMisCov(misCovDat,px=4,kerType="RBF",kerMethod="DR",                                                  lambda=1,sigma=0.1,psPath,impPath,B=2,testPurpose="testing")
trainRes$hatAlphaDR
```

Using the doubly-robust kernel machines to predict Y in the testing dataset
```{r}
Tx1=testData$x1
Tx2=testData$x2
Tx3=testData$x3
Tx4=testData$x4
Tx5=testData$x5
Tx6=testData$x6
TR=rep(1,length(Tx1))
dataTst=as.data.frame(cbind(Tx1,Tx2,Tx3,Tx6,Tx4,Tx5,TR,testData$Y))
names(dataTst)=c("x1","x2","x3","x4","x5","x6","R","Y")

testingMisCov(trainRes,dataTst)
```


